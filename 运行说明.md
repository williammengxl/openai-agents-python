# OpenAI Agents SDK Python - 运行说明

## ✅ 环境配置成功

### 已安装组件
- Python 3.9.6
- 虚拟环境 (.venv)
- openai-agents 0.4.2
- 所有核心依赖

## 🎉 演示运行成功

我已经成功运行了框架演示，所有核心功能都正常工作！

### 演示内容

1. **✅ 核心模块导入** - Agent, Runner, function_tool 等
2. **✅ 创建代理** - 基本代理配置
3. **✅ 工具系统** - 函数装饰器自动生成工具
4. **✅ 多代理协作** - Handoffs 机制
5. **✅ 结构化输出** - Pydantic 模型输出
6. **✅ 模型设置** - Temperature, Max Tokens 等
7. **✅ 会话管理** - SQLite 会话存储
8. **✅ 自定义上下文** - 用户上下文传递
9. **✅ 追踪系统** - 内置追踪功能
10. **✅ 执行引擎** - Runner 配置

## 📝 代码示例

### 1. 最简单的 Hello World

```python
from agents import Agent, Runner
import asyncio

async def main():
    agent = Agent(
        name="助手",
        instructions="你是一个有帮助的助手。",
    )
    
    result = await Runner.run(agent, "写一首关于编程的俳句")
    print(result.final_output)

if __name__ == "__main__":
    asyncio.run(main())
```

### 2. 使用工具的代理

```python
from agents import Agent, Runner, function_tool
import asyncio

@function_tool
def get_weather(city: str) -> str:
    """获取指定城市的天气
    
    Args:
        city: 城市名称
    """
    return f"{city}的天气是晴天，温度20°C"

async def main():
    agent = Agent(
        name="天气助手",
        instructions="你可以查询天气信息。",
        tools=[get_weather],
    )
    
    result = await Runner.run(agent, "北京今天天气怎么样？")
    print(result.final_output)

if __name__ == "__main__":
    asyncio.run(main())
```

### 3. 多代理协作（Handoffs）

```python
from agents import Agent, Runner
import asyncio

# 创建专家代理
math_agent = Agent(
    name="数学专家",
    handoff_description="处理数学问题的专家",
    instructions="你是数学专家，详细解答数学问题。",
)

history_agent = Agent(
    name="历史专家",
    handoff_description="处理历史问题的专家",
    instructions="你是历史专家，回答历史相关问题。",
)

# 创建路由代理
triage_agent = Agent(
    name="路由助手",
    instructions="根据用户问题类型，转接到合适的专家代理。",
    handoffs=[math_agent, history_agent],
)

async def main():
    result = await Runner.run(triage_agent, "什么是勾股定理？")
    print(result.final_output)
    print(f"当前代理: {result.current_agent.name}")

if __name__ == "__main__":
    asyncio.run(main())
```

### 4. 结构化输出

```python
from agents import Agent, Runner
from pydantic import BaseModel
import asyncio

class WeatherInfo(BaseModel):
    city: str
    temperature: int
    condition: str
    advice: str

async def main():
    agent = Agent(
        name="天气助手",
        instructions="提供结构化的天气信息。",
        output_type=WeatherInfo,
    )
    
    result = await Runner.run(agent, "北京今天天气怎么样？")
    weather = result.final_output_as(WeatherInfo)
    
    print(f"城市: {weather.city}")
    print(f"温度: {weather.temperature}°C")
    print(f"天气: {weather.condition}")
    print(f"建议: {weather.advice}")

if __name__ == "__main__":
    asyncio.run(main())
```

### 5. 使用会话（Session）

```python
from agents import Agent, Runner, SQLiteSession
import asyncio

async def main():
    agent = Agent(
        name="助手",
        instructions="你是一个有帮助的助手，回答要简洁。",
    )
    
    # 创建会话
    session = SQLiteSession("conversation_123", "conversations.db")
    
    # 第一轮对话
    result = await Runner.run(
        agent,
        "金门大桥在哪个城市？",
        session=session
    )
    print(f"第一轮: {result.final_output}")
    
    # 第二轮对话 - 代理自动记住上下文
    result = await Runner.run(
        agent,
        "那是在哪个州？",
        session=session
    )
    print(f"第二轮: {result.final_output}")

if __name__ == "__main__":
    asyncio.run(main())
```

## 🚀 如何运行

### 前提条件

1. **设置 OpenAI API Key**（运行真实示例需要）
   ```bash
   export OPENAI_API_KEY='sk-your-api-key-here'
   ```

2. **激活虚拟环境**
   ```bash
   cd /Users/williammeng/agent-ai/openai-agents-python/openai-agents-python
   source .venv/bin/activate
   ```

### 运行演示

```bash
# 运行框架功能演示（无需 API key）
python simple_demo.py

# 运行官方示例（需要 API key）
python examples/basic/hello_world.py
python examples/agent_patterns/routing.py
python examples/tools/web_search.py
```

### 运行测试

```bash
# 安装测试依赖
pip install pytest pytest-asyncio pytest-mock

# 运行所有测试
pytest tests/ -v

# 运行特定测试
pytest tests/test_agent_runner.py -v
pytest tests/test_function_tool.py -v
```

## 📁 项目结构

```
openai-agents-python/
├── src/agents/              # 核心源代码
│   ├── agent.py            # Agent 类
│   ├── run.py              # Runner 执行引擎
│   ├── tool.py             # 工具系统
│   ├── handoffs.py         # 切换机制
│   ├── guardrail.py        # 安全检查
│   ├── models/             # 模型提供商
│   ├── tracing/            # 追踪系统
│   ├── memory/             # 会话管理
│   └── ...
│
├── examples/                # 示例代码
│   ├── basic/              # 基础示例
│   ├── agent_patterns/     # 设计模式
│   ├── tools/              # 工具使用
│   ├── handoffs/           # 切换示例
│   └── ...
│
├── tests/                   # 测试套件
├── docs/                    # 文档（多语言）
├── simple_demo.py           # 框架演示（已运行成功）
└── 运行说明.md             # 本文档
```

## 🎓 学习路径

### 1. 入门（5分钟）
- 运行 `simple_demo.py` 了解框架结构
- 查看 `examples/basic/hello_world.py`

### 2. 基础（30分钟）
- 学习工具使用: `examples/basic/tools.py`
- 学习切换机制: `examples/agent_patterns/routing.py`
- 学习会话管理: `examples/memory/sqlite_session_example.py`

### 3. 进阶（2小时）
- 多代理模式: `examples/agent_patterns/`
- 安全检查: `examples/basic/tool_guardrails.py`
- 复杂应用: `examples/research_bot/`

### 4. 高级（1天）
- 阅读源代码: `src/agents/`
- 查看测试: `tests/`
- 自定义扩展: 模型、工具、会话

## 📚 文档链接

- **官方文档**: https://openai.github.io/openai-agents-python/
- **GitHub**: https://github.com/openai/openai-agents-python
- **快速开始**: docs/quickstart.md
- **API 参考**: docs/ref/

## 💡 常见问题

### Q: 为什么需要 API key？
A: 运行真实 LLM 需要调用 OpenAI API。演示脚本不需要 API key。

### Q: 支持其他 LLM 吗？
A: 是的！通过 LiteLLM 支持 100+ LLM 提供商。

### Q: 如何调试？
A: 使用内置追踪系统，查看 OpenAI Dashboard 或 Logfire。

### Q: 如何部署到生产环境？
A: 使用 Redis Session、配置追踪、设置 Guardrails。

## 🎉 下一步

1. **设置 API key** 并运行真实示例
2. **查看 examples/** 目录学习更多模式
3. **阅读文档** 了解高级功能
4. **构建应用** 开始你的项目！

---

**状态**: ✅ 环境配置完成，演示运行成功
**时间**: 2025-10-31
**版本**: openai-agents 0.4.2

